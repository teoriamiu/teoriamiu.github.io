<!DOCTYPE html>
<html lang="es">

<head>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora Nutricional + VDR Personalizado</title>
  <style>
    /* General */
    body {
      background-color: #f9f9f9;
      color: #333;
      font-family: 'Montserrat', sans-serif;
      font-size: 16px;
      margin: 0;
      padding: 20px;
    }
    
    h1 {
      text-align: center;
      font-size: 2.5em;
      margin-bottom: 30px;
    }
    
    /* Contenedor principal */
    .container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      margin: 0 auto 40px;
      transition: transform 0.3s ease-in-out;
    }
    
    /* Hover en el contenedor */
    .container:hover {
      transform: scale(1.02);
    }
    
    /* Inputs, Selects, Textareas */
    /* Inputs y selects */
    input,
    select {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 8px;
      font-size: 1em;
      border: 1px solid #ccc;
      transition: border 0.3s ease-in-out, background-color 0.3s ease-in-out;
    }
    
    input:hover,
    select:hover {
      background-color: #e6e6e6;
      border: 1px solid #888;
    }
    
    /* Botones (modo claro) */
    button {
      width: 100%;
      padding: 14px;
      margin-top: 10px;
      background: linear-gradient(to right, #03a9f4, #0288d1);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    button:hover {
      background: linear-gradient(to right, #0288d1, #0277bd);
    }
    
    /* Botones */
    button {
      background: linear-gradient(to right, #03a9f4, #0288d1);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      padding: 14px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    button:hover {
      background: linear-gradient(to right, #0288d1, #0277bd);
    }
    
    /* Loading */
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      font-size: 2em;
      font-weight: bold;
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    
    /* Sugerencias */
    .sugerencia-item {
      padding: 10px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }
    
    .sugerencia-item:hover {
      background-color: #f0f0f0;
      transform: scale(1.02);
    }
    
    /* Historial */
    .historial-alimentos {
      background: white;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      max-width: 600px;
      margin: 20px auto;
    }
    
    .historial-item {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
      font-size: 0.95em;
    }
    
    /* Resultado */
    #resultado {
      max-width: 600px;
      margin: 0 auto;
    }
    
    #resultado>div {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeSlideIn 0.6s ease forwards;
    }
    
    /* Animaci√≥n para elementos */
    @keyframes fadeSlideIn {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Estilos de la barra de progreso */
    #resultado .progress-bar {
      height: 10px;
      border-radius: 5px;
      background-color: #eee;
      margin: 5px 0;
    }
    
    .progress-bar .fill {
      height: 100%;
      border-radius: 5px;
    }
    
    /* Estilo de los botones de eliminar */
    .btn-eliminar {
      background: linear-gradient(to right, #03a9f4, #0288d1);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 4px 8px;
      font-size: 0.8em;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .btn-eliminar:hover {
      background: linear-gradient(to right, #0288d1, #0277bd);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      body {
        font-size: 14px;
        padding: 10px;
      }
      
      .container {
        padding: 15px;
      }
      
      button {
        width: 100%;
        margin-bottom: 10px;
      }
      
      input,
      select {
        width: 100%;
        margin-bottom: 10px;
      }
      
      .historial-alimentos {
        padding: 12px;
      }
    }
    
    /* General */
    body {
      background-color: #f9f9f9;
      color: #333;
      font-family: 'Montserrat', sans-serif;
      font-size: 16px;
      margin: 0;
      padding: 20px;
    }
    
    /* T√≠tulos */
    h1,
    h2 {
      text-align: center;
      font-weight: 600;
      margin-bottom: 20px;
    }
    
    /* Contenedor principal */
    .container {
      background: #ffffff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      max-width: 800px;
      margin: 20px auto;
      transition: all 0.3s ease-in-out;
    }
    
    /* Input y Select */
    input,
    select {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1em;
      transition: border-color 0.3s;
    }
    
    input:focus,
    select:focus {
      border-color: #4f46e5;
      outline: none;
    }
    
    /* Botones */
    button {
      width: 100%;
      padding: 14px;
      margin-top: 10px;
      background-color: #4f46e5;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    button:hover {
      background-color: #4338ca;
    }
    
    /* Resultado */
    #resultado {
      max-width: 800px;
      margin: 20px auto;
      padding-top: 20px;
    }
    
    /* Estilos para cada nutriente */
    #resultado>div {
      margin-bottom: 18px;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeSlideIn 0.6s forwards;
    }
    
    /* Link a Wikipedia */
    #resultado a {
      color: #4f46e5;
      font-weight: 600;
      text-decoration: none;
      transition: color 0.3s;
    }
    
    #resultado a:hover {
      color: #4338ca;
      text-decoration: underline;
    }
    
    /* Barra de progreso */
    .progress-bar {
      background-color: #eee;
      height: 12px;
      border-radius: 6px;
      overflow: hidden;
      margin-top: 5px;
    }
    
    .fill {
      height: 100%;
      border-radius: 6px;
      transition: width 0.5s ease-in-out;
    }
    
    /* Animaci√≥n para aparecer */
    @keyframes fadeSlideIn {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Footer */
    .footer {
      margin-top: 40px;
      padding: 20px;
      background-color: #f8f9fa;
      text-align: center;
      font-size: 14px;
      color: #777;
      border-radius: 12px;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      body {
        font-size: 14px;
        padding: 10px;
      }
      
      .container {
        padding: 15px;
      }
      
      button {
        width: 100%;
      }
      
      input,
      select {
        width: 100%;
      }
    }
    
    /* Modo oscuro (fondo oscuro y texto claro) */
    body.dark-mode {
      background-color: #121212;
      color: #eeeeee;
    }
    
    body.dark-mode input,
    body.dark-mode select,
    body.dark-mode button:not(.modo-toggle) {
      background-color: #1e1e1e;
      color: #eee;
      border-color: #555;
    }
    
    body.dark-mode .container,
    body.dark-mode .footer {
      background-color: #1a1a1a;
      color: #ddd;
    }
    
    /* Estilo exclusivo para el bot√≥n modo claro/oscuro */
    .modo-toggle {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 9999;
      background: none !important;
      border: none !important;
      padding: 0;
      margin: 0;
      cursor: pointer;
      font-size: 28px;
      width: auto !important;
      color: #333;
    }
    
    body.dark-mode .modo-toggle {
      color: #fff;
      filter: drop-shadow(0 0 6px white);
    }
    
    /* Ajustes para botones comunes en modo oscuro (excepto el de modo toggle) */
    body.dark-mode button:not(.modo-toggle) {
      background-color: #333;
      color: #eee;
      border: 1px solid #555;
    }
    
    body.dark-mode button:not(.modo-toggle):hover {
      background-color: #444;
    }
    
    /* Borrar historial en modo oscuro */
    body.dark-mode .btn-borrar-historial {
      background-color: #333 !important;
      color: #eee !important;
      border: 1px solid #555 !important;
    }
    
    body.dark-mode .btn-borrar-historial:hover {
      background-color: #444 !important;
    }
    
    body.dark-mode .btn-borrar-historial {
      background-color: #333 !important;
      color: #eee !important;
      border: 1px solid #555 !important;
    }
    
    body.dark-mode .btn-borrar-historial:hover {
      background-color: #444 !important;
    }
    
    /* Contenedor del historial en modo oscuro */
    body.dark-mode .historial {
      background-color: #1e1e1e;
      color: #eee;
      border-radius: 12px;
      padding: 16px;
    }
    
    /* √çtems del historial */
    body.dark-mode .historial li {
      color: #ddd;
    }
    
    /* T√≠tulo del historial */
    body.dark-mode .historial h2 {
      color: #fff;
    }
    
    /* Historial: fondo y texto en modo oscuro */
    body.dark-mode .historial,
    body.dark-mode .historial-alimentos {
      background-color: #1e1e1e;
      color: #eee;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    }
    
    /* T√≠tulo del historial en modo oscuro */
    body.dark-mode .historial h2,
    body.dark-mode .historial-alimentos h2 {
      color: #fff;
    }
    
    /* Lista del historial (√≠tems) */
    body.dark-mode .historial ul li,
    body.dark-mode .historial-alimentos ul li {
      color: #ddd;
      border-bottom: 1px solid #444;
      padding: 4px 0;
    }
    
    /* Animaci√≥n de aparici√≥n suave para elementos del historial */
    .historial ul li {
      opacity: 0;
      transform: translateY(10px);
      animation: aparecerItem 0.4s ease forwards;
    }
    
    @keyframes aparecerItem {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Animaci√≥n para cada nuevo resultado VDR */
    #resultado>div {
      opacity: 0;
      transform: translateY(15px);
      animation: resultadoFadeIn 0.5s ease forwards;
    }
    
    @keyframes resultadoFadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Transici√≥n suave para todo el body (modo oscuro y claro) */
    body {
      transition: background-color 0.4s ease, color 0.4s ease;
    }
    
    .lista-alimentos {
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
      border-radius: 10px;
      background-color: #f3f3f3;
      padding: 10px;
      box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.05);
    }
    
    body.dark-mode .lista-alimentos {
      background-color: #1e1e1e;
      box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.05);
    }
    
    .lista-alimentos .item-alimento {
      padding: 8px;
      margin-bottom: 8px;
      background: #ffffff;
      border-radius: 8px;
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
    }
    
    body.dark-mode .item-alimento {
      background: #2a2a2a;
      color: #eee;
    }
    
    .item-alimento .nombre {
      flex: 1;
    }
    
    .item-alimento .eliminar {
      margin-left: 10px;
      background: linear-gradient(to right, #03a9f4, #0288d1);
      /* celeste */
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 0.8em;
      transition: background 0.3s;
    }
    
    .item-alimento .eliminar:hover {
      background: linear-gradient(to right, #0288d1, #0277bd);
    }
    
    .sugerencia-item {
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .sugerencia-item:hover {
      background-color: #f0f0f0;
    }
    
    .sugerencias-dropdown {
      position: absolute;
      top: 58px;
      left: 0;
      right: 0;
      background-color: #fff;
      border: 1px solid #ccc;
      max-height: 180px;
      overflow-y: auto;
      z-index: 1000;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      border-radius: 4px;
    }
    
    .sugerencia-item {
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .sugerencia-item:hover {
      background-color: #f0f0f0;
    }
    
    body.dark-mode .sugerencias-dropdown {
      background-color: #2a2a2a;
      color: #eee;
      border: 1px solid #555;
    }
    
    body.dark-mode .sugerencia-item {
      color: #eee;
    }
    
    body.dark-mode .sugerencia-item:hover {
      background-color: #444;
    }
  </style>
</head>

<body>
  
  <button id="modoBtn" onclick="cambiarModo()" class="modo-toggle">‚òÄÔ∏è</button>
  
  <main>
    <h1>Calculadora Nutricional</h1>
    
    <div id="loading" class="loading">
      Cargando...
    </div>
    
    <div id="alimentos-seleccionados" class="alimentos-seleccionados">
      <!-- Aqu√≠ se mostrar√°n los alimentos agregados -->
    </div>
    
    <div id="historial-alimentos" class="historial-alimentos">
      <h3>Historial de alimentos buscados</h3> <!-- El t√≠tulo -->
      <div id="lista-historial"></div> <!-- La lista donde se cargan los alimentos -->
      <button onclick="borrarHistorial()" class="btn-borrar-historial">Borrar historial</button>
    </div>
    
    <div class="buscador-alimentos" style="position: relative;">
      <label for="buscar">Buscar alimento:</label>
      <input type="text" id="buscar" placeholder="Ej: 100g manzana">
      <div id="sugerencias" class="sugerencias-dropdown"></div>
      <button onclick="buscarDesdeInput()">Agregar alimento</button>
      <button onclick="limpiarCampos()">Limpiar campos</button>
    </div>
    <h2>Alimentos agregados</h2>
    <div id="listaAlimentos" class="lista-alimentos"></div>
    <div class="container">
      <label for="edad">Edad:</label>
      <input type="number" id="edad" placeholder="Ej: 25">
      
      <label for="sexo">Sexo:</label>
      <select id="sexo">
        <option value="masculino">Ayrton</option>
        <option value="femenino">Noe</option>
      </select>
      
      <label for="actividad">Nivel de actividad f√≠sica:</label>
      <select id="actividad">
        <option value="sedentario">Sedentario</option>
        <option value="moderado">Moderado</option>
        <option value="activo">Activo</option>
      </select>
      
      <div class="container">
        
        <h2>Macronutrientes</h2>
        <label for="calorias">Calor√≠as:</label>
        <input type="number" id="calorias" placeholder="Ej: 2000">
        
        <label for="proteinas">Prote√≠nas (g):</label>
        <input type="number" id="proteinas" placeholder="Ej: 50">
        
        <label for="carbohidratos">Carbohidratos (g):</label>
        <input type="number" id="carbohidratos" placeholder="Ej: 250">
        
        <label for="grasa">Grasas Totales (g):</label>
        <input type="number" id="grasa" placeholder="Ej: 70">
        
        <h2>Vitaminas</h2>
        <label for="vitaminaA">Vitamina A (¬µg):</label>
        <input type="number" id="vitaminaA" placeholder="Ej: 900">
        
        <label for="vitaminaB1">Vitamina B1 (mg):</label>
        <input type="number" id="vitaminaB1" placeholder="Ej: 1.2">
        
        <label for="vitaminaB2">Vitamina B2 (mg):</label>
        <input type="number" id="vitaminaB2" placeholder="Ej: 1.3">
        
        <label for="vitaminaB3">Vitamina B3 (mg):</label>
        <input type="number" id="vitaminaB3" placeholder="Ej: 16">
        
        <label for="vitaminaB5">Vitamina B5 (mg):</label>
        <input type="number" id="vitaminaB5" placeholder="Ej: 5">
        
        <label for="vitaminaB6">Vitamina B6 (mg):</label>
        <input type="number" id="vitaminaB6" placeholder="Ej: 1.3">
        
        <label for="vitaminaB7">Vitamina B7 (¬µg):</label>
        <input type="number" id="vitaminaB7" placeholder="Ej: 30">
        
        <label for="vitaminaB9">Vitamina B9 (¬µg):</label>
        <input type="number" id="vitaminaB9" placeholder="Ej: 400">
        
        <label for="vitaminaB12">Vitamina B12 (¬µg):</label>
        <input type="number" id="vitaminaB12" placeholder="Ej: 2.4">
        
        <label for="vitaminaC">Vitamina C (mg):</label>
        <input type="number" id="vitaminaC" placeholder="Ej: 90">
        
        <label for="vitaminaD">Vitamina D (IU):</label>
        <input type="number" id="vitaminaD" placeholder="Ej: 600">
        
        <label for="vitaminaE">Vitamina E (mg):</label>
        <input type="number" id="vitaminaE" placeholder="Ej: 15">
        
        <label for="vitaminaK">Vitamina K (¬µg):</label>
        <input type="number" id="vitaminaK" placeholder="Ej: 120">
        
        <h2>Minerales</h2>
        <label for="azufre">Azufre (mg):</label>
        <input type="number" id="azufre" placeholder="Ej: 800">
        
        <label for="calcio">Calcio (mg):</label>
        <input type="number" id="calcio" placeholder="Ej: 1000">
        
        <label for="cobre">Cobre (mg):</label>
        <input type="number" id="cobre" placeholder="Ej: 0.9">
        
        <label for="cromo">Cromo (¬µg):</label>
        <input type="number" id="cromo" placeholder="Ej: 35">
        
        <label for="cobalto">Cobalto (¬µg):</label>
        <input type="number" id="cobalto" placeholder="Ej: 5">
        
        <label for="cloro">Cloro (mg):</label>
        <input type="number" id="cloro" placeholder="Ej: 2300">
        
        <label for="fosforo">F√≥sforo (mg):</label>
        <input type="number" id="fosforo" placeholder="Ej: 700">
        
        <label for="fluor">Fl√∫or (mg):</label>
        <input type="number" id="fluor" placeholder="Ej: 4">
        
        <label for="hierro">Hierro (mg):</label>
        <input type="number" id="hierro" placeholder="Ej: 18">
        
        <label for="magnesio">Magnesio (mg):</label>
        <input type="number" id="magnesio" placeholder="Ej: 400">
        
        <label for="manganeso">Manganeso (mg):</label>
        <input type="number" id="manganeso" placeholder="Ej: 2.3">
        
        <label for="potasio">Potasio (mg):</label>
        <input type="number" id="potasio" placeholder="Ej: 4700">
        
        <label for="selenio">Selenio (¬µg):</label>
        <input type="number" id="selenio" placeholder="Ej: 55">
        
        <label for="yodo">Yodo (¬µg):</label>
        <input type="number" id="yodo" placeholder="Ej: 150">
        
        <label for="zinc">Zinc (mg):</label>
        <input type="number" id="zinc" placeholder="Ej: 11">
        
        <h2>Amino√°cidos</h2>
        <label for="alanina">Alanina (g):</label>
        <input type="number" id="alanina" placeholder="Ej: 1">
        <label for="arginina">Arginina (g):</label>
        <input type="number" id="arginina" placeholder="Ej: 1">
        
        <label for="asparagina">Asparagina (g):</label>
        <input type="number" id="asparagina" placeholder="Ej: 1">
        
        <label for="acidoAspartico">√Åcido Asp√°rtico (g):</label>
        <input type="number" id="acidoAspartico" placeholder="Ej: 2">
        
        <label for="acidoGlutamico">√Åcido Glut√°mico (g):</label>
        <input type="number" id="acidoGlutamico" placeholder="Ej: 3">
        
        <label for="cisteina">Ciste√≠na (g):</label>
        <input type="number" id="cisteina" placeholder="Ej: 0.3">
        
        <label for="glicina">Glicina (g):</label>
        <input type="number" id="glicina" placeholder="Ej: 0.8">
        
        <label for="histidina">Histidina (g):</label>
        <input type="number" id="histidina" placeholder="Ej: 0.7">
        
        <label for="isoleucina">Isoleucina (g):</label>
        <input type="number" id="isoleucina" placeholder="Ej: 1.3">
        
        <label for="leucina">Leucina (g):</label>
        <input type="number" id="leucina" placeholder="Ej: 2.5">
        
        <label for="lisina">Lisina (g):</label>
        <input type="number" id="lisina" placeholder="Ej: 2.3">
        
        <label for="metionina">Metionina (g):</label>
        <input type="number" id="metionina" placeholder="Ej: 0.9">
        
        <label for="fenilalanina">Fenilalanina (g):</label>
        <input type="number" id="fenilalanina" placeholder="Ej: 1.6">
        
        <label for="prolina">Prolina (g):</label>
        <input type="number" id="prolina" placeholder="Ej: 1">
        
        <label for="serina">Serina (g):</label>
        <input type="number" id="serina" placeholder="Ej: 1">
        
        <label for="treonina">Treonina (g):</label>
        <input type="number" id="treonina" placeholder="Ej: 1.2">
        
        <label for="tript√≥fano">Tript√≥fano (g):</label>
        <input type="number" id="tript√≥fano" placeholder="Ej: 0.3">
        
        <label for="tirosina">Tirosina (g):</label>
        <input type="number" id="tirosina" placeholder="Ej: 1.2">
        
        <label for="valina">Valina (g):</label>
        <input type="number" id="valina" placeholder="Ej: 1.7">
        
        <h2>√Åcidos Grasos</h2>
        <label for="omega3">Omega 3 (g):</label>
        <input type="number" id="omega3" placeholder="Ej: 1.6">
        
        <label for="omega6">Omega 6 (g):</label>
        <input type="number" id="omega6" placeholder="Ej: 17">
        
        <label for="omega9">Omega 9 (g):</label>
        <input type="number" id="omega9" placeholder="Ej: 10">
        
        <h2>Otros nutrientes</h2>
        
        <label for="azucar">Az√∫car (g):</label>
        <input type="number" id="azucar" placeholder="Ej: 30">
        
        <label for="sodio">Sodio (mg):</label>
        <input type="number" id="sodio" placeholder="Ej: 2300">
        
        <label for="colesterol">Colesterol (mg):</label>
        <input type="number" id="colesterol" placeholder="Ej: 300">
        
        <label for="fibra">Fibra (g):</label>
        <input type="number" id="fibra" placeholder="Ej: 25">
        
        <label for="azucarAgregada">Az√∫car Agregada (g):</label>
        <input type="number" id="azucarAgregada" placeholder="Ej: 25">
        
        <label for="grasasTrans">Grasas Trans (g):</label>
        <input type="number" id="grasasTrans" placeholder="Ej: 2">
        
        <label for="agua">Agua (g):</label>
        <input type="number" id="agua" placeholder="Ej: 1500">
        
        <button onclick="calcular()">Calcular VDR</button>
        
        <div class="resultado" id="resultado"></div>
        <div id="compartir-contenedor" style="text-align: center; margin-top: 20px; display: none;">
          <button id="btnCompartir" class="btn-compartir" onclick="compartirResultados()">Compartir Resultados</button>
        </div>
  </main>
  
  <script>
    let gramosSeleccionados = 100;
    let alimentosSeleccionados = [];
    const apiKey = "CG2yX4SYvLy4rHv2aUu5nsuUgCIMNJdRPpdOS6Jj"; // Tu API Key oficial
    
    function limpiarCampos() {
      const inputs = document.querySelectorAll("input[type='number']");
      inputs.forEach(input => input.value = "");
    }
    
    function borrarHistorial() {
      localStorage.removeItem('historialAlimentos');
      mostrarHistorial(); // Refrescamos la lista vac√≠a
    }
    
    async function buscarAlimento() {
      let termino = document.getElementById('buscar').value.trim().toLowerCase();
      
      if (termino.length === 0) {
        document.getElementById('sugerencias').innerHTML = '';
        return;
      }
      
      // Mostrar el cargador mientras busca
      document.getElementById('loading').style.display = 'flex';
      
      // Verificar si existe traducci√≥n
      if (traducciones[termino]) {
        termino = traducciones[termino];
      }
      
      const url = `https://api.nal.usda.gov/fdc/v1/foods/search?api_key=${apiKey}&query=${encodeURIComponent(termino)}`;
      
      try {
        const respuesta = await fetch(url);
        const datos = await respuesta.json();
        
        mostrarSugerencias(datos.foods);
        
        // Ocultar el cargador cuando se termine de cargar
        document.getElementById('loading').style.display = 'none';
        
      } catch (error) {
        console.error('Error buscando alimento:', error);
        document.getElementById('loading').style.display = 'none';
      }
    }
    
    function mostrarSugerencias(alimentos) {
      const sugerenciasDiv = document.getElementById('sugerencias');
      sugerenciasDiv.innerHTML = '';
      
      alimentos.slice(0, 5).forEach(alimento => {
        const div = document.createElement('div');
        div.classList.add('sugerencia-item');
        div.textContent = alimento.description;
        div.onclick = () => seleccionarAlimentoUSDA(alimento, gramosSeleccionados);
        sugerenciasDiv.appendChild(div);
      });
    }
    
    async function seleccionarAlimentoUSDA(alimento, gramos = 100) {
      limpiarCampos(); // <- aqu√≠ se limpian los inputs ANTES de sumar
      
      const detalle = await fetch(`https://api.nal.usda.gov/fdc/v1/food/${alimento.fdcId}?api_key=${apiKey}`).then(r => r.json());
      
      const nutrientes = detalle.foodNutrients;
      
      nutrientes.forEach(n => {
        const nombre = n.nutrient.name.toLowerCase().trim();
        const idHTML = mapaNutrientes[nombre];
        const cantidad = (n.amount * gramos) / 100;
        
        if (idHTML && document.getElementById(idHTML)) {
          const actual = parseFloat(document.getElementById(idHTML).value) || 0;
          document.getElementById(idHTML).value = (actual + cantidad).toFixed(2);
        }
      });
      
      alimentosSeleccionados.push(detalle);
      mostrarAlimentosSeleccionados();
      agregarAlHistorial(`${gramos}g ${alimento.description}`);
      calcularTotales();
      
      document.getElementById("sugerencias").innerHTML = "";
    }
    
    function guardarEnHistorial(alimento) {
      let historial = JSON.parse(localStorage.getItem('historialAlimentos')) || [];
      
      historial.unshift(alimento.description); // Agregamos al principio
      historial = historial.slice(0, 10); // Guardamos m√°ximo los √∫ltimos 10 alimentos
      
      localStorage.setItem('historialAlimentos', JSON.stringify(historial));
      
      mostrarHistorial();
    }
    
    function mostrarHistorial() {
      const contenedor = document.getElementById('lista-historial');
      contenedor.innerHTML = '';
      
      let historial = JSON.parse(localStorage.getItem('historialAlimentos')) || [];
      
      historial.forEach(nombre => {
        const div = document.createElement('div');
        div.classList.add('historial-item');
        div.textContent = nombre;
        contenedor.appendChild(div);
      });
    }
    
    function mostrarAlimentosSeleccionados() {
      const contenedor = document.getElementById('alimentos-seleccionados');
      contenedor.innerHTML = '';
      
      alimentosSeleccionados.forEach((alimento, index) => {
        const div = document.createElement('div');
        div.classList.add('alimento-item');
        
        div.innerHTML = `
      ${index + 1}. ${alimento.description}
      <button onclick="eliminarAlimento(${index})" class="btn-eliminar">Eliminar</button>
    `;
        
        contenedor.appendChild(div);
      });
      
      // NUEVO: ocultar el bot√≥n compartir si no hay alimentos
      if (alimentosSeleccionados.length === 0) {
        document.getElementById('compartir-contenedor').style.display = 'none';
      }
    }
    
    function eliminarAlimento(index) {
      alimentosSeleccionados.splice(index, 1); // Eliminamos el alimento de la lista
      mostrarAlimentosSeleccionados(); // Actualizamos la lista visual
      calcularTotales(); // Recalculamos los nutrientes totales
    }
    
    function calcularTotales() {
      const campos = [
        "calorias", "proteinas", "carbohidratos", "grasa",
        "vitaminaA", "vitaminaB1", "vitaminaB2", "vitaminaB3", "vitaminaB5", "vitaminaB6", "vitaminaB7", "vitaminaB9", "vitaminaB12",
        "vitaminaC", "vitaminaD", "vitaminaE", "vitaminaK",
        "azufre", "calcio", "cobre", "cromo", "cobalto", "cloro", "fosforo", "fluor", "hierro", "magnesio", "manganeso", "potasio", "selenio", "yodo", "zinc",
        "alanina", "arginina", "asparagina", "acidoAspartico", "acidoGlutamico", "cisteina", "glicina", "histidina", "isoleucina", "leucina", "lisina", "metionina",
        "fenilalanina", "prolina", "serina", "treonina", "tript√≥fano", "tirosina", "valina",
        "omega3", "omega6", "omega9",
        "azucar", "azucarAgregada", "fibra", "grasasTrans", "agua", "sodio", "colesterol"
      ];
      
      const totales = {};
      campos.forEach(campo => totales[campo] = 0);
      
      alimentosSeleccionados.forEach(alimento => {
        const nutrientes = alimento.foodNutrients;
        nutrientes.forEach(n => {
          const nombre = n.nutrient.name.toLowerCase().trim();
          const idHTML = mapaNutrientes[nombre];
          if (idHTML && totales.hasOwnProperty(idHTML)) {
            totales[idHTML] += n.amount || 0;
          }
        });
      });
      
      for (const [id, valor] of Object.entries(totales)) {
        const input = document.getElementById(id);
        if (input) {
          input.value = valor.toFixed(2);
        }
      }
    }
    
    function encontrarValor(nutrientes, nombreBuscado) {
      const nutriente = nutrientes.find(n => n.nutrientName === nombreBuscado);
      return nutriente ? nutriente.value : null;
    }
    
    function calcular() {
      // Primero capturamos edad, sexo y nivel de actividad
      
      const edad = parseInt(document.getElementById('edad')?.value) || 30;
      const sexo = document.getElementById('sexo')?.value || "masculino";
      const actividad = document.getElementById('actividad')?.value || "moderado";
      document.getElementById('compartir-contenedor').style.display = 'block';
      
      // Lista de campos que vamos a evaluar
      const campos = [
        "calorias", "proteinas", "carbohidratos", "grasa",
        "vitaminaA", "vitaminaB1", "vitaminaB2", "vitaminaB3", "vitaminaB5", "vitaminaB6", "vitaminaB7", "vitaminaB9", "vitaminaB12",
        "vitaminaC", "vitaminaD", "vitaminaE", "vitaminaK",
        "azufre", "calcio", "cobre", "cromo", "cobalto", "cloro", "fosforo", "fluor", "hierro", "magnesio", "manganeso", "potasio", "selenio", "yodo", "zinc",
        "alanina", "arginina", "asparagina", "acidoAspartico", "acidoGlutamico", "cisteina", "glicina", "histidina", "isoleucina", "leucina", "lisina", "metionina",
        "fenilalanina", "prolina", "serina", "treonina", "tript√≥fano", "tirosina", "valina",
        "omega3", "omega6", "omega9",
        "azucar", "azucarAgregada", "fibra", "grasasTrans", "agua", "sodio", "colesterol"
      ];
      
      // VDR (Valores Diarios Recomendados) base
      let vdr = {
        calorias: 2000,
        proteinas: 50,
        carbohidratos: 300,
        grasa: 70,
        vitaminaA: 900,
        vitaminaB1: 1.2,
        vitaminaB2: 1.3,
        vitaminaB3: 16,
        vitaminaB5: 5,
        vitaminaB6: 1.3,
        vitaminaB7: 30,
        vitaminaB9: 400,
        vitaminaB12: 2.4,
        vitaminaC: 90,
        vitaminaD: 600,
        vitaminaE: 15,
        vitaminaK: 120,
        azufre: 800,
        calcio: 1000,
        cobre: 0.9,
        cromo: 35,
        cobalto: 5,
        cloro: 2300,
        fosforo: 700,
        fluor: 4,
        hierro: 18,
        magnesio: 400,
        manganeso: 2.3,
        potasio: 4700,
        selenio: 55,
        yodo: 150,
        zinc: 11,
        alanina: 1,
        arginina: 1,
        asparagina: 1,
        acidoAspartico: 2,
        acidoGlutamico: 3,
        cisteina: 0.3,
        glicina: 0.8,
        histidina: 0.7,
        isoleucina: 1.3,
        leucina: 2.5,
        lisina: 2.3,
        metionina: 0.9,
        fenilalanina: 1.6,
        prolina: 1,
        serina: 1,
        treonina: 1.2,
        tript√≥fano: 0.3,
        tirosina: 1.2,
        valina: 1.7,
        omega3: 1.6,
        omega6: 17,
        omega9: 10,
        azucar: 30,
        azucarAgregada: 25,
        fibra: 25,
        grasasTrans: 2,
        agua: 1500,
        sodio: 2300,
        colesterol: 300
      };
      
      // Ajustes seg√∫n edad
      if (edad < 18) {
        vdr.calorias -= 300;
        vdr.proteinas -= 5;
      } else if (edad > 50) {
        vdr.calorias -= 200;
        vdr.calcio += 200;
        vdr.vitaminaD += 200;
      }
      
      // Ajustes seg√∫n sexo
      if (sexo === "femenino") {
        vdr.hierro += 8;
      }
      
      // Ajustes seg√∫n nivel de actividad f√≠sica
      if (actividad === "moderado") {
        vdr.calorias += 200;
      } else if (actividad === "activo") {
        vdr.calorias += 400;
      }
      
      // Ahora mostramos los resultados
      const resultadoDiv = document.getElementById('resultado');
      resultadoDiv.innerHTML = '';
      
      campos.forEach(campo => {
        const valor = parseFloat(document.getElementById(campo)?.value) || 0;
        const vdrValor = vdr[campo] || 1;
        let porcentaje = (valor / vdrValor) * 100;
        
        porcentaje = Math.min(porcentaje, 200); // Limitamos m√°ximo al 200%
        
        // Creamos el nombre bonito para mostrar
        const nombreBonito = campo.replace(/([A-Z])/g, ' $1').replace(/_/g, ' ').replace(/acido/g, "√Åcido").replace(/omega/g, "Omega ").replace(/tript√≥fano/g, "Tript√≥fano").replace(/fluor/g, "Fl√∫or").replace(/fosforo/g, "F√≥sforo").replace(/cobalto/g, "Cobalto").replace(/selenio/g, "Selenio");
        
        // Creamos el link a Wikipedia
        const linkWiki = `https://es.wikipedia.org/wiki/${encodeURIComponent(nombreBonito.trim())}`;
        
        // Armamos el resultado
        resultadoDiv.innerHTML += `
      <div style="margin-bottom: 12px;">
        <div style="margin-bottom: 4px;">
          <a href="${linkWiki}" target="_blank" style="color: #4f46e5; text-decoration: none;">
            ${nombreBonito.charAt(0).toUpperCase() + nombreBonito.slice(1)}
          </a>: ${porcentaje.toFixed(1)}%
        </div>
        <div class="progress-bar">
          <div class="fill" style="width: ${porcentaje}%; background: ${colorSegunPorcentaje(porcentaje)};"></div>
        </div>
      </div>
    `;
      });
    }
    
    // Funci√≥n para decidir el color de la barra
    function colorSegunPorcentaje(p) {
      if (p < 90) return 'grey';
      if (p <= 110) return 'green';
      return 'red';
    }
    
    const traducciones = {
      "pollo": "chicken",
      "manzana": "apple",
      "naranja": "orange",
      "banana": "banana",
      "zanahoria": "carrot",
      "lechuga": "lettuce",
      "almendra": "almond",
      "nuez": "walnut",
      "carne": "beef",
      "pescado": "fish",
      "tomate": "tomato",
      "brocoli": "broccoli",
      "papa": "potato",
      "arroz": "rice",
      "huevo": "egg",
      "pera": "pear",
      "uva": "grape",
      "frutilla": "strawberry",
      "mango": "mango",
      "pepino": "cucumber",
      "limon": "lemon",
      "sandia": "watermelon"
    };
    
    mostrarHistorial();
    
    function compartirResultados() {
      const resultadoDiv = document.getElementById('resultado');
      
      if (!resultadoDiv.innerText.trim()) {
        alert("Primero calcula tus resultados antes de compartir.");
        return;
      }
      
      const texto = "¬°Mir√° mis resultados nutricionales!\n\n" + resultadoDiv.innerText.trim();
      
      if (navigator.share) {
        navigator.share({
          title: "Resultados Nutricionales",
          text: texto
        }).then(() => {
          console.log("Compartido exitosamente");
        }).catch(error => {
          console.error("Error al compartir:", error);
        });
      } else {
        navigator.clipboard.writeText(texto).then(() => {
          alert("Resultados copiados al portapapeles. ¬°Ahora pod√©s pegarlos donde quieras!");
        }).catch(error => {
          console.error("Error al copiar:", error);
        });
      }
    }
    
    function cambiarModo() {
      const body = document.body;
      const boton = document.getElementById('modoBtn');
      
      body.classList.toggle('dark-mode');
      
      // Cambiar el emoji
      boton.textContent = body.classList.contains('dark-mode') ? 'üåô' : '‚òÄÔ∏è';
      
      // Guardar preferencia
      localStorage.setItem('modo', body.classList.contains('dark-mode') ? 'oscuro' : 'claro');
      
      // Animaci√≥n (si quer√©s que gire)
      boton.classList.add('rotar');
      setTimeout(() => boton.classList.remove('rotar'), 500);
    }
    
    // Al cargar la p√°gina, restaurar el modo guardado
    window.addEventListener('load', () => {
      const modo = localStorage.getItem('modo');
      const boton = document.getElementById('modoBtn');
      if (modo === 'oscuro') {
        document.body.classList.add('dark-mode');
        boton.textContent = 'üåô';
      } else {
        boton.textContent = '‚òÄÔ∏è';
      }
    });
    const mapaNutrientes = {
      // Macronutrientes
      "energy": "calorias",
      "protein": "proteinas",
      "carbohydrate, by difference": "carbohidratos",
      "total lipid (fat)": "grasa",
      
      // Vitaminas
      "vitamin a, rae": "vitaminaA",
      "vitamin b-1 (thiamin)": "vitaminaB1",
      "vitamin b-2 (riboflavin)": "vitaminaB2",
      "vitamin b-3 (niacin)": "vitaminaB3",
      "pantothenic acid": "vitaminaB5",
      "vitamin b-6": "vitaminaB6",
      "biotin": "vitaminaB7",
      "folate, total": "vitaminaB9",
      "vitamin b-12": "vitaminaB12",
      "vitamin c, total ascorbic acid": "vitaminaC",
      "vitamin d (d2 + d3)": "vitaminaD",
      "vitamin e (alpha-tocopherol)": "vitaminaE",
      "vitamin k (phylloquinone)": "vitaminaK",
      
      // Minerales
      "sulfur, s": "azufre",
      "calcium, ca": "calcio",
      "copper, cu": "cobre",
      "chromium, cr": "cromo",
      "cobalt, co": "cobalto",
      "chloride, cl": "cloro",
      "phosphorus, p": "fosforo",
      "fluoride, f": "fluor",
      "iron, fe": "hierro",
      "magnesium, mg": "magnesio",
      "manganese, mn": "manganeso",
      "potassium, k": "potasio",
      "selenium, se": "selenio",
      "iodine, i": "yodo",
      "zinc, zn": "zinc",
      
      // Amino√°cidos
      "alanine": "alanina",
      "arginine": "arginina",
      "asparagine": "asparagina",
      "aspartic acid": "acidoAspartico",
      "glutamic acid": "acidoGlutamico",
      "cystine": "cisteina",
      "glycine": "glicina",
      "histidine": "histidina",
      "isoleucine": "isoleucina",
      "leucine": "leucina",
      "lysine": "lisina",
      "methionine": "metionina",
      "phenylalanine": "fenilalanina",
      "proline": "prolina",
      "serine": "serina",
      "threonine": "treonina",
      "tryptophan": "tript√≥fano",
      "tyrosine": "tirosina",
      "valine": "valina",
      
      // √Åcidos grasos
      "omega-3 fatty acids": "omega3",
      "omega-6 fatty acids": "omega6",
      "oleic acid": "omega9",
      
      // Otros
      "sugars, total including nlea": "azucar",
      "sugar, added": "azucarAgregada",
      "fiber, total dietary": "fibra",
      "fatty acids, total trans": "grasasTrans",
      "water": "agua",
      "sodium, na": "sodio",
      "cholesterol": "colesterol"
    };
    
    const acumulado = {};
    
    async function buscarDesdeInput() {
      const input = document.getElementById("buscar").value.trim();
      const match = input.match(/^(\d+)\s*(g|gr|gramos)?\s+(.*)$/i);
      
      if (!match) {
        alert("Escrib√≠ algo como: 100g manzana");
        return;
      }
      
      const gramos = parseFloat(match[1]);
      gramosSeleccionados = gramos;
      const nombre = match[3];
      
      const searchUrl = `https://api.nal.usda.gov/fdc/v1/foods/search?query=${encodeURIComponent(nombre)}&pageSize=10&api_key=${apiKey}`;
      
      try {
        const res = await fetch(searchUrl);
        const data = await res.json();
        
        if (!data.foods || data.foods.length === 0) {
          alert("No se encontr√≥ el alimento.");
          return;
        }
        
        mostrarSugerencias(data.foods);
        
      } catch (error) {
        console.error("Error:", error);
        alert("Ocurri√≥ un error al buscar el alimento.");
      }
    }
    
    function agregarFilaResumen(nombre) {
      const tabla = document.getElementById("tablaResumen");
      const fila = document.createElement("tr");
      fila.innerHTML = `<td>${nombre}</td><td>Agregado</td>`;
      tabla.appendChild(fila);
    }
    
    function agregarAlHistorial(nombre) {
      const contenedor = document.getElementById("listaAlimentos");
      const div = document.createElement("div");
      div.className = "item-alimento";
      
      const nombreDiv = document.createElement("div");
      nombreDiv.className = "nombre";
      nombreDiv.textContent = nombre;
      
      const btn = document.createElement("button");
      btn.className = "eliminar";
      btn.textContent = "Eliminar";
      btn.onclick = () => contenedor.removeChild(div);
      
      div.appendChild(nombreDiv);
      div.appendChild(btn);
      contenedor.appendChild(div);
    }
    document.getElementById("buscar").addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        event.preventDefault(); // evita que se recargue la p√°gina
        buscarDesdeInput(); // ejecuta la b√∫squeda
      }
    });
    document.addEventListener("click", function(e) {
      if (!document.getElementById("buscar").contains(e.target) &&
        !document.getElementById("sugerencias").contains(e.target)) {
        document.getElementById("sugerencias").innerHTML = "";
      }
    });
  </script>
  <footer class="footer">
    <p>&copy; 2025 NutriCalc. Todos los derechos reservados.</p>
  </footer>
</body>

</html>
